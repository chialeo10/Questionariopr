import React, { useState } from 'react';
import { createClient } from '@supabase/supabase-js';

// Configura Supabase
const supabaseUrl = 'YOUR_SUPABASE_URL';
const supabaseKey = 'YOUR_SUPABASE_ANON_KEY';
const supabase = createClient(supabaseUrl, supabaseKey);

const Questionario = () => {
  const [risposte, setRisposte] = useState({});

  const handleChange = (q, value) => {
    setRisposte(prev => ({ ...prev, [q]: value }));
  };

  const handleCheckboxChange = (q, value) => {
    const current = risposte[q] || [];
    if (current.includes(value)) {
      setRisposte(prev => ({ ...prev, [q]: current.filter(v => v !== value) }));
    } else {
      setRisposte(prev => ({ ...prev, [q]: [...current, value] }));
    }
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    const { data, error } = await supabase.from('risposte').insert([risposte]);
    if (error) {
      alert('Errore nel salvataggio: ' + error.message);
    } else {
      alert('Risposte salvate con successo!');
      setRisposte({});
    }
  };

  const regioni = [
    'Abruzzo','Basilicata','Calabria','Campania','Emilia-Romagna','Friuli Venezia Giulia','Lazio','Liguria','Lombardia','Marche','Molise','Piemonte','Puglia','Sardegna','Sicilia','Toscana','Trentino-Alto Adige','Umbria','Valle d’Aosta','Veneto'
  ];

  return (
    <form onSubmit={handleSubmit} style={{ maxWidth: '800px', margin: 'auto', padding: '20px', fontFamily: 'Arial, sans-serif' }}>
      <h1>Benvenuti – Questionario sulle Competenze Digitali degli Over 50</h1>
      <p>Non ci sono risposte giuste o sbagliate. Tutte le risposte sono anonime e per scopo di ricerca.</p>
      
      <h2>Sezione I: Domande socio-demografiche</h2>
      <label>Q.001 Data di nascita:</label>
      <input type="date" value={risposte.q001 || ''} onChange={e => handleChange('q001', e.target.value)} />

      <div>
        <label>Q.002 Genere:</label><br/>
        <input type="radio" name="q002" checked={risposte.q002 === 'Maschio'} onChange={() => handleChange('q002','Maschio')} /> Maschio<br/>
        <input type="radio" name="q002" checked={risposte.q002 === 'Femmina'} onChange={() => handleChange('q002','Femmina')} /> Femmina
      </div>

      <div>
        <label>Q.003 Regione di residenza:</label><br/>
        <select value={risposte.q003 || ''} onChange={e => handleChange('q003', e.target.value)}>
          <option value="">Seleziona regione</option>
          {regioni.map(r => <option key={r} value={r}>{r}</option>)}
        </select>
      </div>

      {/* Esempio Sezione Dispositivi Digitali */}
      <h2>Sezione II: Domande su dispositivi digitali</h2>
      <label>Q.008 Quali dispositivi possiedi o a quali hai accesso?</label><br/>
      {['Computer fisso o portatile','Smartphone','Tablet / iPad','Smart TV','Altro','Nessun dispositivo digitale'].map(d => (
        <div key={d}>
          <input type="checkbox" checked={(risposte.q008 || []).includes(d)} onChange={() => handleCheckboxChange('q008', d)} /> {d}
        </div>
      ))}

      {/* Submit button */}
      <button type="submit" style={{ marginTop: '20px', padding: '10px 20px', fontSize: '16px' }}>Invia risposte</button>
    </form>
  );
};

export default Questionario;
